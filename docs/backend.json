{
  "entities": {
    "UserAccount": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserAccount",
      "type": "object",
      "description": "Stores user account information, excluding sensitive authentication data.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user account."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "registrationDate": {
          "type": "string",
          "description": "Date and time when the user registered.",
          "format": "date-time"
        },
        "profileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserAccount 1:1 UserProfile)"
        }
      },
      "required": [
        "id",
        "email",
        "registrationDate",
        "profileId"
      ]
    },
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Stores user profile information, such as name, preferences, and fitness goals.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "firstName": {
          "type": "string",
          "description": "User's first name."
        },
        "lastName": {
          "type": "string",
          "description": "User's last name."
        },
        "dateOfBirth": {
          "type": "string",
          "description": "User's date of birth.",
          "format": "date"
        },
        "gender": {
          "type": "string",
          "description": "User's gender."
        },
        "weightGoal": {
          "type": "string",
          "description": "User's weight goal (e.g., lose weight, gain muscle)."
        },
        "dietaryPreferences": {
          "type": "array",
          "description": "References to DietaryRestrictions. (Relationship: UserProfile 1:N DietaryRestriction)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "dateOfBirth",
        "gender",
        "weightGoal"
      ]
    },
    "DietaryRestriction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DietaryRestriction",
      "type": "object",
      "description": "Stores dietary restrictions.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the dietary restriction."
        },
        "restrictionName": {
          "type": "string",
          "description": "The name of the dietary restriction."
        }
      },
      "required": [
        "id",
        "restrictionName"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/account",
        "definition": {
          "entityName": "UserAccount",
          "schema": {
            "$ref": "#/backend/entities/UserAccount"
          },
          "description": "Stores user account information. Access is restricted to the user identified by {userId}.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user account."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/profile",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. Access is restricted to the user identified by {userId}.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user profile, matching the associated user account."
            }
          ]
        }
      },
      {
        "path": "/dietary_restrictions/{restrictionId}",
        "definition": {
          "entityName": "DietaryRestriction",
          "schema": {
            "$ref": "#/backend/entities/DietaryRestriction"
          },
          "description": "Stores a master list of dietary restrictions. Globally readable, only writable by authorized admins.",
          "params": [
            {
              "name": "restrictionId",
              "description": "The unique identifier for the dietary restriction."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore structure prioritizes security and scalability for the AI Fitness Hub application, focusing on user account management. It adheres to the core design principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), and QAPs (Rules Are Not Filters). Path-based ownership is employed to secure user-specific data.\n\n- **/users/{userId}/account**: Stores user account information. Access is restricted to the user identified by `{userId}`. This ensures that only the user can read and write their own account data.\n\n- **/users/{userId}/profile**: Stores user profile information. Access is restricted to the user identified by `{userId}`. This is the same security posture as `account` data.\n\n- **/dietary_restrictions/{restrictionId}**: Stores a master list of dietary restrictions.  This is globally readable but only writable by authorized admins (roles stored elsewhere - outside the scope of this design).\n\n**Authorization Independence:** Achieved by using path-based ownership. Access to user accounts and profiles is directly tied to the `userId` in the path, eliminating the need for `get()` calls to parent documents to determine authorization.\n\n**QAPs (Rules Are Not Filters):** The structure supports secure `list` operations. Listing user accounts or profiles is generally not required. However, if an admin function needed to list all users it could be done in a secure fashion by enforcing role based access on the `users` collection."
  }
}